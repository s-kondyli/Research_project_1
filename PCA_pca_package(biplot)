import pandas as pd
import matplotlib.pyplot as plt
from pca import pca
from skbio.stats.composition import clr, multiplicative_replacement

data = pd.read_csv('C:/Users/lilak/Documents/Master BMS-O/Research Project 1/mOTUs/bacteria_1042_Patient.csv')
data = data[data['Name'].notna()] # drops NaN values from Name column
data = data[['Name', 'Day_related_to_HCT', 'Read_counts']]
data = data.pivot(index='Day_related_to_HCT', columns='Name', values='Read_counts')
data = data.fillna(0) # fills NaN values with 0 for the matrix
data.to_csv('C:/Users/lilak/Documents/Master BMS-O/Research Project 1/temp.csv')
data = pd.read_csv('C:/Users/lilak/Documents/Master BMS-O/Research Project 1/temp.csv')
X = data.drop('Day_related_to_HCT', axis=1)
X = multiplicative_replacement(X)
# Clr transform
X = clr(X)
labels = data.Day_related_to_HCT
model = pca(n_components=2, normalize=True)
results = model.fit_transform(X)
model.biplot(n_feat=4, y=labels, legend=False)
plt.show()
