import pandas as pd
import numpy as np
from matplotlib import pyplot as plt
from matplotlib.pyplot import figure
import re

# Import tsv files
data = pd.read_csv("C:/Users/lilak/Documents/Master BMS-O/Research Project 1/Results from assembly step/mg.kraken.parsed_1042F.tsv", sep='\t')

# Keeps from the column K all the values that are not NaN (basically drops NaN from specific column)
data = data[data['K'].notna()]
data = data[data['D'].notna()]

# Keeps the rows of the column K that contain a specific name
df = data.loc[data['D'].str.contains('Eukaryota')]
df = data.loc[data['K'].str.contains('Fungi')]

# Keeps from the column S all the values that are not NaN (we need it because some rows are empty/not classified)
df = df.loc[df['S'].notna()]

# Creates a new percentage column that for each row in the groupby object calculates the percentage of the contig length 
df['%'] = df.groupby(['S'])['length'].transform(lambda x: x/x.sum()*100)
# Reorder and keep only the columns you are interested in
df = df[['S', 'length']]

# Get statistics for each group 
df = df.groupby('S').describe().unstack(1).reset_index().pivot(index='S', columns='level_1', values=0).reset_index()

# Save to a file
df.to_csv('C:/Users/lilak/Documents/Master BMS-O/Research Project 1/Results from assembly step/assembly_stats_sPatientID.csv', index=False)
