import pandas as pd
import numpy as np
from matplotlib import pyplot as plt
from matplotlib.pyplot import figure
import seaborn as sns

df = pd.read_excel('C:/Users/lilak/Documents/Master BMS-O/Research Project 1/Python/Results_python.xlsx', sheet_name='Patient_1179')
#calculates the percentage of tha daily total reads of each taxon 
dict_counts={}
grouped=df.groupby("Day_related_to_HCT")
for day,group in grouped:
    dict_counts[day]='x'
newgroup=df.groupby("Day_related_to_HCT").sum()
for key,value in dict_counts.items():
    dict_counts[key]=newgroup.loc[key]['Read_counts']
df['corresp_sum']=df['Day_related_to_HCT'].map(dict_counts)
df['percent']=df.apply(lambda row: row.Read_counts/row.corresp_sum*100,axis=1)

df1=df.groupby(['Day_related_to_HCT','Name'])['percent'].sum().sort_values(ascending=False).reset_index()
df1.pivot_table(index='Day_related_to_HCT', columns='Name').plot(kind= 'bar', stacked=True )
plt.legend(loc=2,  prop={'size':3})
plt.title('Patient 1179 microbiota composition over time')
plt.xlabel('Day related to HCT')
plt.tight_layout()
plt.ylabel('% of read counts')
plt.show()



